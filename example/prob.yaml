# Matmul m x k x n = 100 x 300 x 200
# for m in 0..100
#   for k in 0..300
#     for n in 0..200
#       C[m][n] += A[m][k] * B[k][n]
loops:
  - iter_name: "m"
    bounds: [0, 100]
    step: 1
  - iter_name: "k"
    step: 1
    bounds: [0, 300]
  - iter_name: "n"
    bounds: [0, 200]
    step: 1
body:
  - !DataLoad
    array_name: "A"
    addr: "k + 300m"
    reg: "Ra"
  - !Conditional
    cond_compute:
      !Compute
        op: "cmp"
        src: ["Ra"]
        dst: "Rcmp"
    prob: 0.5
  - !DataLoad
    array_name: "B"
    addr: "n + 200k"
    reg: "Rb"
    cond: "Rcmp"
  - !DataLoad
    array_name: "C"
    addr: "n + 200m"
    reg: "Rc"
    cond: "Rcmp"
  - !Compute
    op: "mac"
    src: ["Ra", "Rb", "Rc"]
    dst: "Rc"
    cond: "Rcmp"
  - !DataStore
    array_name: "store_C"
    addr: "n + 200m"
    reg: "Rc"
    cond: "Rcmp"